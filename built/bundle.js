!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);var n={cards:[58,84],chips:[20,20]},r=[[20,20],[300,20],[580,20],[20,565],[300,565],[580,565]],a=["left","center","right","left","center","right"];function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],n=!0,r=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(o.push(i.value),!t||o.length!==t);n=!0);}catch(e){r=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var l=function(){return"_"+Math.random().toString(36).substr(2,9)},s=function(e,t){var o=e.getBoundingClientRect();return[t.clientX-o.left,t.clientY-o.top]},d=function(){for(var e=[],t=1;t<=13;t++)for(var o=0;o<4;o++)e.push({suit:o,val:t,mode:"faceDown",id:l()});return function(e){for(var t=e.length-1;t>0;t--){var o=Math.floor(Math.random()*(t+1)),n=[e[o],e[t]];e[t]=n[0],e[o]=n[1]}return e}(e)},u=function(e){var t;1===e.val?t="Ace":e.val>=2&&e.val<=10?t=e.val+"":11===e.val?t="Jack":12===e.val?t="Queen":13===e.val&&(t="King");return{name:t,suit:["Spades","Clubs","Hearts","Diamonds"][e.suit]}},p=function(e){return"".concat(e.name.toLowerCase(),"_of_").concat(e.suit.toLowerCase())},f=function(e,t){var o,r,a=e.pos,c=e.type;if("text"===c||"menuText"===c)o=e.width,r=e.height,r+=3;else{var l=i(n[c],2);o=l[0],r=l[1]}return t[0]>a[0]&&t[0]<a[0]+o&&t[1]>a[1]&&t[1]<a[1]+r},g=function(e,t){for(var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=i(n[e.type],2),a=r[0],c=r[1],l=[e.pos[0]+o,e.pos[1]+o],s=[e.pos[0]+a-o,e.pos[1]+o],d=[e.pos[0]+o,e.pos[1]-o+c],u=[e.pos[0]+a-o,e.pos[1]-o+c],p=[l,s,d,u],g=0,b=p;g<b.length;g++){var v=b[g];if(f(t,v))return!0}return!1};function b(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){if(e){if("string"==typeof e)return y(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var h=!1,m=function(){return{type:"cards",cards:d(),pos:[20,260],id:l()}},j=function(e,t,o,n){e.playerObjs.length<6&&e.playerObjs.push({type:"player",name:t,pos:n,id:o})},S=function(e){if(h)throw"Should not be asked to use ctx on server";var t=document.createElement("canvas");t.width=500;var o=t.getContext("2d");o.font="".concat(15,"px Arial"),e.width=o.measureText(e.text).width,e.height=15},k=function(e){var t={type:"menu",relatedToObj:e,options:[]};if("cards"===e.type){t.options.push({text:e.cards.length>1?"Flip top card":"Flip card",type:"menuText",action:{actionType:"flip"}}),t.options.push({text:e.cards.length>1?"Peek at top card":"Peek at card",type:"menuText",action:{actionType:"peek"}}),e.cards.length>1&&t.options.push({text:"Grab card stack",type:"menuText",action:{actionType:"dragX",count:1/0}}),t.options.push({text:"Gather all cards and shuffle",type:"menuText",action:{actionType:"gatherAndSetDeck"}})}return"chips"===e.type&&(t.options=[{text:"Grab chip",type:"menuText",action:{actionType:"dragX",count:1}}],e.count>1&&t.options.push({text:"Grab chip stack",type:"menuText",action:{actionType:"dragX",count:1/0}}),e.count>5&&t.options.push({text:"Grab 5 chips",type:"menuText",action:{actionType:"dragX",count:5}})),function(e){if(void 0!==e.options&&0!==e.options.length){e.options.forEach(S),e.maxTextWidth=e.options.map((function(e){return e.width})).reduce((function(e,t){return Math.max(e,t)})),e.width=e.maxTextWidth+10,e.height=20*e.options.length+5;var t=b(e.relatedToObj.pos);t[0]+e.width>600&&(t[0]=600-e.width),t[1]+e.height>600&&(t[1]=600-e.height),e.pos=t;for(var o=0;o<e.options.length;o++)e.options[o].pos=[5+t[0],5+t[1]+20*o]}}(t),t.options.length>0?t:void 0},I=function(e,t){var o=[].concat(b(e.cardsObjs),b(e.chipsObjs),b(e.textObjs)).filter((function(e){return e.id===t}));if(o.length>0)return o[0]},T=function(e,t){console.log("will do actions",e);var o,n=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=v(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw r}}}}(e);try{for(n.s();!(o=n.n()).done;){var r=o.value;if("resetGame"===r.actionType&&location.reload(),"assignLock"===r.actionType&&t.blockedActionsAndMeta.blockedOnAcquiringLockId===r.lockId&&(t.blockedActionsAndMeta.unblocked=!0),"popTop"===r.actionType){var a=I(t,r.fromObjWId);if(void 0===a){console.warn("Could not take action",r);break}if("cards"===a.type){var i={type:"cards",cards:[a.cards.pop()],pos:a.pos,id:r.newObjId};t.cardsObjs.push(i)}if("chips"===a.type){a.count--;var c={type:"chips",count:1,pos:a.pos,colorI:a.colorI,id:r.newObjId};t.chipsObjs.push(c)}}if("setInputState"===r.actionType){for(var l=r.newInputState,s=0,d=Object.keys(l.objsById);s<d.length;s++){var u=d[s];l[u]=I(t,l.objsById[u])}delete l.objsById,t.inputState=l,console.log(t.inputState)}if("setObjPos"===r.actionType){var p,f;if(r.fromServer)if("dragging"===(null===(p=t.inputState)||void 0===p?void 0:p.mode))if(r.objId===(null===(f=t.inputState.objDragged)||void 0===f?void 0:f.id)){t.inputState=void 0;break}var g=I(t,r.objId);if(void 0===g){console.warn("Could not take action",r);break}g.pos=r.pos}if("mergeObjs"===r.actionType)if("break"===function(){var e=r.objIds.map((function(e){return I(t,e)}));if(e.filter((function(e){return void 0===e})).length>0)return console.warn("Could not take action",r),"break";"chips"===e[0].type&&(t.chipsObjs=t.chipsObjs.filter((function(t){return t!==e[0]})),e[1].count+=e[0].count),"cards"===e[0].type&&(t.cardsObjs=t.cardsObjs.filter((function(t){return t!==e[0]})),e[1].cards=[].concat(b(e[1].cards),b(e[0].cards)))}())break;if("clearInputState"===r.actionType&&(t.inputState=void 0),"flip"===r.actionType){var y=I(t,r.objsById.cardsObj);y.cards[y.cards.length-1].mode=r.toFace}if("gatherAndSetDeck"===r.actionType&&(t.cardsObjs=[r.newDeck]),"separateChips"===r.actionType){var h=I(t,r.chipsObjId);if(void 0===h){console.warn("Could not take action",r);break}t.chipsObjs.push({type:"chips",count:h.count-r.countToSplit,pos:h.pos,colorI:h.colorI,id:r.newChipsId}),h.count=r.countToSplit}if("openMenu"===r.actionType){var m=I(t,r.objId);if(void 0===m){console.warn("Could not take action",r);break}var S=k(m);S.mouseDownPosOnRelatedObj=r.menuClickPos,t.menuObjs.push(S)}if("closeMenus"===r.actionType&&(t.menuObjs=[]),"setPeekState"===r.actionType){var T=I(t,r.cardObjId);if(void 0===T||void 0===r.playerId){console.warn("Could not take action",r);break}var O=T.cards[T.cards.length-1];O.peeking=O.peeking||[],O.peeking[r.playerId]=r.peekState}"addPlayer"===r.actionType&&j(t,r.playerName,r.id,r.pos)}}catch(e){n.e(e)}finally{n.f()}};function O(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=A(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw r}}}}function A(e,t){if(e){if("string"==typeof e)return C(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var D=document.querySelector("canvas"),P=D.getContext("2d");P.textBaseline="top",P.font="".concat(15,"px Arial");var x=function(){var e,t=d().map(u),o=[],n=w(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=new Image,i=p(r);a.src="cards-svgs/".concat(i,".svg"),o[i]=a}}catch(e){n.e(e)}finally{n.f()}return function(e){var t=u(e),n=p(t);return o[n]}}(),M=new Image;M.src="cards-svgs/card_back.svg";var L,q,E,B=function(e){var t=function(e,t){var o,n,r={mode:"doneDragging",objDragged:e.objDragged};if("cards"===(null==e||null===(o=e.objDragged)||void 0===o?void 0:o.type)){var a,i=w(t.cardsObjs.filter((function(t){return t!==e.objDragged})));try{for(i.s();!(a=i.n()).done;){var c=a.value;if(g(c,e.objDragged,10)){r.objDraggedOnto=c;break}}}catch(e){i.e(e)}finally{i.f()}}if("chips"===(null==e||null===(n=e.objDragged)||void 0===n?void 0:n.type)){var l,s=w(t.chipsObjs.filter((function(t){return t!==e.objDragged})));try{for(s.s();!(l=s.n()).done;){var d=l.value;if(g(d,e.objDragged,5)){r.objDraggedOnto=d;break}}}catch(e){s.e(e)}finally{s.f()}}return r};D.addEventListener("mousedown",(function(o){var n;if(!(e.blockedActionsAndMeta.blockedActions.length>0)){var r,a=s(D,o);if(void 0===e.inputState){var i,c=[].concat(O(e.cardsObjs),O(e.chipsObjs),O(e.textObjs)),l=w(e.menuObjs);try{for(l.s();!(i=l.n()).done;){var d,u=i.value,p=w(u.options);try{for(p.s();!(d=p.n()).done;){var g=d.value;f(g,a)&&(r={mode:"clicked",objClicked:u,optionTextObjClicked:g,mouseDownPos:a})}}catch(e){p.e(e)}finally{p.f()}}}catch(e){l.e(e)}finally{l.f()}if(void 0===r){var b,v=1/0,y=w(c);try{for(y.s();!(b=y.n()).done;){var h=b.value;f(h,a)&&("chips"!==h.type||"chips"===h.type&&h.count<v)&&(r={mode:"clickedMaybeWillDrag",objDragged:h,mouseDownTime:Date.now(),mouseDownPos:a},v=void 0!==h.count?h.count:v)}}catch(e){y.e(e)}finally{y.f()}}}"draggingMouseUp"===(null===(n=e.inputState)||void 0===n?void 0:n.mode)&&(r=t(e.inputState,e)),void 0!==r&&(e.inputState=r)}})),D.addEventListener("mousemove",(function(t){var o,n,r;if(t.preventDefault(),!(e.blockedActionsAndMeta.blockedActions.length>0)){var a,i,c,l=s(D,t);"clickedMaybeWillDrag"===(null===(o=e.inputState)||void 0===o?void 0:o.mode)&&(i=l,c=e.inputState.mouseDownPos,Math.sqrt(Math.pow(i[0]-c[0],2)+Math.pow(i[1]-c[1],2))>10&&(a={mode:"readyToStartDragging",objDragged:e.inputState.objDragged,mouseDownPos:e.inputState.mouseDownPos,mousePos:l,objInitPos:e.inputState.objDragged.pos})),"dragging"!==(null===(n=e.inputState)||void 0===n?void 0:n.mode)&&"draggingMouseUp"!==(null===(r=e.inputState)||void 0===r?void 0:r.mode)||(a=Object.assign({},e.inputState,{mousePos:l})),void 0!==a&&(e.inputState=a)}}));var o=function(o){var n,r;if(!(e.blockedActionsAndMeta.blockedActions.length>0)){var a,i=s(D,o);"dragging"===(null===(n=e.inputState)||void 0===n?void 0:n.mode)&&(a=t(e.inputState,e)),"clickedMaybeWillDrag"===(null===(r=e.inputState)||void 0===r?void 0:r.mode)&&(a={mode:"clicked",objClicked:e.inputState.objDragged,mouseDownPos:e.inputState.mouseDownPos}),void 0===e.inputState&&(a={mode:"clicked",objClicked:void 0,mouseDownPos:i}),void 0!==a&&(e.inputState=a)}};D.addEventListener("mouseup",o),D.addEventListener("mouseout",o);var n=function(){var t=document.querySelector("input");if(t.value.length>0){var o=l(),n={type:"text",text:t.value,pos:r[e.playerObjs.length]};!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",o=arguments.length>2?arguments[2]:void 0;"center"===t&&(e.pos[0]-=o(e.text||e.name).width/2),"right"===t&&(e.pos[0]-=o(e.text||e.name).width)}(n,a[e.playerObjs.length],(function(e){return P.measureText(e)})),e.inputState={mode:"actions",action:{actionType:"addPlayer",playerName:t.value,id:o,pos:n.pos}},localStorage.playerId=o,t.value=""}};document.querySelector("#addPlayerButton").addEventListener("click",n),document.querySelector("input").addEventListener("keypress",(function(e){"Enter"===e.key&&n()})),document.querySelector("#resetGameButton").addEventListener("click",(function(){confirm("This will remove all progress and cannot be undone. Are you sure?")&&(e.inputState={mode:"actions",action:{actionType:"resetGame"}})}))},G=0,_=function e(t){var o,r,a,i=t.gameState,c=t.fromServerActionContainer,s=t.sendActionsToServer;if(0===(G=(G+1)%4)){c.actions.length>0&&(console.log("Doing action from server"),T(c.actions,i),console.log("Clearing fromServerActionContainer"),c.actions=[]);if(0===i.blockedActionsAndMeta.blockedActions.length||i.blockedActionsAndMeta.unblocked){var d=i.blockedActionsAndMeta.unblocked?[]:function(e,t){void 0!==e&&console.log(e);var o,n=[];if("actions"===(null==e?void 0:e.mode)&&(n.push(e.action),n.push({actionType:"clearInputState"})),"readyToStartDragging"===(null==e?void 0:e.mode))if("cards"===e.objDragged.type||"chips"===e.objDragged.type)if((null===(o=e.objDragged.cards)||void 0===o?void 0:o.length)>1||e.objDragged.count>1){var r=l();console.log("will queue up requestLock"),n.push({actionType:"requestLock",lockId:r,objId:e.objDragged.id});var a=l();n.push({actionType:"popTop",fromObjWId:e.objDragged.id,newObjId:a}),n.push({actionType:"setInputState",newInputState:{mode:"dragging",objsById:{objDragged:a},objInitPos:e.objInitPos,mouseDownPos:e.mouseDownPos,mousePos:e.mousePos}})}else n.push({actionType:"setInputState",newInputState:{mode:"dragging",objsById:{objDragged:e.objDragged.id},objInitPos:e.objInitPos,mouseDownPos:e.mouseDownPos}});else n.push({actionType:"setInputState",newInputState:{mode:"dragging",objsById:{objDragged:e.objDragged.id},objInitPos:e.objInitPos,mouseDownPos:e.mouseDownPos}});if("dragging"!==(null==e?void 0:e.mode)&&"draggingMouseUp"!==(null==e?void 0:e.mode)||n.push({actionType:"setObjPos",objId:e.objDragged.id,pos:[e.objInitPos[0]+e.mousePos[0]-e.mouseDownPos[0],e.objInitPos[1]+e.mousePos[1]-e.mouseDownPos[1]]}),"doneDragging"===(null==e?void 0:e.mode)){var i,c;if(null==e?void 0:e.objDraggedOnto)"cards"===(null==e||null===(i=e.objDragged)||void 0===i?void 0:i.type)&&n.push({actionType:"mergeObjs",objIds:[e.objDragged.id,e.objDraggedOnto.id]}),"chips"===(null==e||null===(c=e.objDragged)||void 0===c?void 0:c.type)&&e.objDraggedOnto.colorI===e.objDragged.colorI&&n.push({actionType:"mergeObjs",objIds:[e.objDragged.id,e.objDraggedOnto.id]});n.push({actionType:"clearInputState"})}if("clicked"===(null==e?void 0:e.mode)){var s,d,u;if("menu"===(null==e||null===(s=e.objClicked)||void 0===s?void 0:s.type)){var p=e.objClicked,f=e.optionTextObjClicked;if("flip"===f.action.actionType){var g=p.relatedToObj,b="faceDown"===g.cards[g.cards.length-1].mode?"faceUp":"faceDown";n.push(Object.assign({},f.action,{objsById:{cardsObj:p.relatedToObj.id},toFace:b})),n.push({actionType:"clearInputState"})}if("peek"===f.action.actionType)if(void 0===localStorage.playerId)alert("Please join the game to peek at cards");else{var v=p.relatedToObj.cards[p.relatedToObj.cards.length-1];n.push({actionType:"setPeekState",cardObjId:p.relatedToObj.id,peekState:!v.peeking||!0!==v.peeking[localStorage.playerId],playerId:localStorage.playerId})}if("gatherAndSetDeck"===f.action.actionType){var y=p.relatedToObj,h=m();h.pos=y.pos,n.push(Object.assign({},f.action,{newDeck:h}))}if("dragX"===f.action.actionType){var j=p.relatedToObj;console.log(j);var S=f.action.count;if(S<j.count){var k=l();n.push({actionType:"separateChips",chipsObjId:j.id,newChipsId:k,countToSplit:S})}n.push({actionType:"setInputState",newInputState:{mode:"draggingMouseUp",objsById:{objDragged:j.id},mouseDownPos:p.mouseDownPosOnRelatedObj,mousePos:e.mouseDownPos,objInitPos:p.relatedToObj.pos}})}n.push({actionType:"closeMenus"})}if("cards"===(null==e||null===(d=e.objClicked)||void 0===d?void 0:d.type)||"chips"===(null==e||null===(u=e.objClicked)||void 0===u?void 0:u.type))t.menuObjs.length>0?n.push({actionType:"closeMenus"}):n.push({actionType:"openMenu",objId:e.objClicked.id,menuClickPos:e.mouseDownPos});void 0===e.objClicked&&n.push({actionType:"closeMenus"}),0===n.filter((function(e){return"setInputState"===e.actionType})).length&&n.push({actionType:"clearInputState"})}return n}(i.inputState,i),u=(o=[].concat(O(i.blockedActionsAndMeta.blockedActions),O(d)),r=o.filter((function(e){return"requestLock"===e.actionType})),a=r.length>0?o.indexOf(r[0]):-1,{nonBlockedActionsForServerAndClient:r.length>0?o.slice(0,a+1):o,blockedActions:r.length>0?o.slice(a+1):[],blockedOnAcquiringLockId:r.length>0?r[0].lockId:void 0}),p=u.nonBlockedActionsForServerAndClient,f=u.blockedActions,g=u.blockedOnAcquiringLockId;i.blockedActionsAndMeta={blockedOnAcquiringLockId:g,blockedActions:f},s(p.filter((function(e){return-1===["closeMenus","openMenu","setInputState","clearInputState"].indexOf(e.actionType)}))),p.length>0&&T(p,i)}else console.log("blocked",i.blockedActionsAndMeta);!function(e){document.querySelector("#addPlayer").style.display=void 0===localStorage.playerId?"block":"none",P.clearRect(0,0,600,600);var t,o=w(e.playerObjs);try{for(o.s();!(t=o.n()).done;){var r=t.value;P.fillStyle="black",P.fillText(r.name,r.pos[0],r.pos[1])}}catch(e){o.e(e)}finally{o.f()}var a,i=w(e.cardsObjs);try{var c=function(){var e=a.value,t=e.pos,o=e.cards,r=o[o.length-1];r.peeking=r.peeking||[],"faceUp"===r.mode?P.drawImage(x(r),t[0],t[1],n.cards[0],n.cards[1]):r.peeking[localStorage.playerId]?(P.globalAlpha=.7,P.drawImage(x(r),t[0],t[1],n.cards[0],n.cards[1]),P.globalAlpha=1):P.drawImage(M,t[0],t[1],n.cards[0],n.cards[1]);var i=o.length>1?"x".concat(o.length," "):"";i=Object.keys(r.peeking).filter((function(e){return r.peeking[e]&&e!==localStorage.playerId})).length>0?i+"👁️":i,P.fillStyle="black",P.fillText(i,t[0],t[1]+n.cards[1])};for(i.s();!(a=i.n()).done;)c()}catch(e){i.e(e)}finally{i.f()}var l,s=w(e.chipsObjs);try{for(s.s();!(l=s.n()).done;){var d=l.value,u=d.pos,p=d.count;P.beginPath(),P.fillStyle="white",P.arc(u[0]+n.chips[0]/2,u[1]+n.chips[0]/2,n.chips[0]/2.2,0,2*Math.PI),P.fill();var f=n.chips[0]/50,g=new Path2D("M 25 1 C 11.759318 1 1 11.759318 1 25 C 1 27.889887 1.5121634 30.661103 2.4511719 33.228516 C 2.453288 33.234301 2.4549108 33.24031 2.4570312 33.246094 C 2.5964788 33.635375 2.743374 34.020934 2.9003906 34.400391 L 2.9140625 34.392578 C 4.4930509 38.094551 6.9790423 41.316994 10.087891 43.789062 C 10.38006 44.021388 10.677478 44.246072 10.980469 44.464844 C 11.019857 44.49333 11.060038 44.52058 11.099609 44.548828 C 11.371996 44.743006 11.64708 44.93231 11.927734 45.115234 C 11.978264 45.148154 12.029278 45.180347 12.080078 45.212891 C 12.370962 45.399378 12.665591 45.579806 12.964844 45.753906 C 12.990837 45.76899 13.016912 45.78384 13.042969 45.798828 C 13.369274 45.987032 13.701387 46.166784 14.037109 46.339844 C 17.325532 48.034976 21.050219 49 25 49 C 38.240682 49 49 38.240682 49 25 C 49 19.520158 47.153666 14.468782 44.054688 10.425781 L 44.099609 10.400391 C 42.782707 8.7022793 41.221708 7.1768671 39.478516 5.8691406 C 39.40253 5.8115067 39.326688 5.7540121 39.25 5.6972656 C 39.082857 5.5748837 38.9126 5.4561718 38.742188 5.3378906 C 38.556802 5.2079794 38.370805 5.0798331 38.181641 4.9550781 C 38.096846 4.8996257 38.011313 4.8454523 37.925781 4.7910156 C 37.643011 4.6096132 37.357095 4.4333715 37.066406 4.2636719 C 37.065152 4.2629397 37.063754 4.2624507 37.0625 4.2617188 C 37.06075 4.2607041 37.058391 4.2607798 37.056641 4.2597656 C 33.511582 2.1922784 29.394237 1 25 1 z M 25 3 C 26.018664 3 27.018305 3.0752737 28 3.2089844 L 28 10.304688 C 27.029777 10.105433 26.026606 10 25 10 C 23.973394 10 22.970223 10.105433 22 10.304688 L 22 3.2089844 C 22.981695 3.0752737 23.981336 3 25 3 z M 42.318359 11.433594 C 43.567745 13.026801 44.601572 14.795566 45.376953 16.699219 L 39.216797 20.269531 C 38.557401 18.30537 37.500237 16.523628 36.142578 15.011719 L 42.318359 11.433594 z M 7.6386719 11.488281 L 13.851562 15.019531 C 12.514738 16.510155 11.470496 18.262558 10.810547 20.193359 L 4.6308594 16.681641 C 5.3965489 14.806503 6.4123178 13.062293 7.6386719 11.488281 z M 25 12 C 32.154545 12 38 17.845455 38 25 C 38 32.154545 32.154545 38 25 38 C 17.845455 38 12 32.154545 12 25 C 12 17.845455 17.845455 12 25 12 z M 39.216797 29.730469 L 45.376953 33.300781 C 44.62144 35.155655 43.620659 36.882165 42.414062 38.443359 L 36.207031 34.916016 C 37.533694 33.419564 38.567878 31.663423 39.216797 29.730469 z M 10.8125 29.814453 C 11.47411 31.746704 12.521842 33.499366 13.861328 34.990234 L 7.7070312 38.599609 C 6.464054 37.02073 5.4331954 35.268423 4.65625 33.382812 L 10.8125 29.814453 z M 28 39.695312 L 28 46.791016 C 27.018305 46.924726 26.018664 47 25 47 C 24.015652 47 23.049576 46.927727 22.099609 46.802734 L 22.099609 39.710938 C 23.039291 39.897308 24.007992 40 25 40 C 26.026606 40 27.029777 39.894567 28 39.695312 z");P.save(),P.translate(u[0],u[1]),P.transform(f,0,0,f,0,0),P.fillStyle=["red","black","blue"][d.colorI],P.fill(g),P.restore(),P.fillStyle="black",P.fillText("x".concat(p),u[0],u[1]+n.chips[0])}}catch(e){s.e(e)}finally{s.f()}var b,v=w(e.textObjs);try{for(v.s();!(b=v.n()).done;){var y=b.value,h=y.pos,m=y.text;P.fillStyle="black",P.fillText(m,h[0],h[1])}}catch(e){v.e(e)}finally{v.f()}var j,S=w(e.menuObjs);try{for(S.s();!(j=S.n()).done;){var k=j.value,I=k.pos,T=k.options,O=k.width,A=k.height;P.fillStyle="rgba(0, 0, 0, 0.7)",P.beginPath(),P.rect(I[0],I[1],O,A),P.fill();for(var C=0;C<T.length;C++){var D=T[C];P.fillStyle="white",P.fillText(D.text,D.pos[0],D.pos[1])}}}catch(e){S.e(e)}finally{S.f()}}(i)}requestAnimationFrame((function(){e({gameState:i,fromServerActionContainer:c,sendActionsToServer:s})}))};L=io(),q={actions:[]},E=function(e){e.length>0&&(console.log("queued sending actions to server",e),e.forEach((function(e){setTimeout((function(){console.log("Sent action to server",e),L.emit("action",e)}),0)})))},L.on("initial state",(function(e){console.log("Got initial state from server",e),0===e.playerObjs.filter((function(e){return e.id===localStorage.playerId})).length&&delete localStorage.playerId,B(e),_({gameState:Object.assign(e,{blockedActionsAndMeta:{blockedOnAcquiringLockId:void 0,blockedActions:[]}}),fromServerActionContainer:q,sendActionsToServer:E})})),L.emit("get state"),L.on("action",(function(e){setTimeout((function(){console.log("Got action from server",e),q.actions.push(e)}),0)}))}]);